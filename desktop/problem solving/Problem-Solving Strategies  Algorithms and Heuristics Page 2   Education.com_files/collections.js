/* JSCmprsd Hash:1b3e50798f8461a92485f29b985c1213 */
/** 
Copyright (c) 2011 Education.com Holdings, Inc. All Rights Reserved.
Duplication without permission prohibited.
 **/
(function(){if(window.ranCollectionJS){return }else{window.ranCollectionJS=true}var C={options:{callClass:"Collect",buttonwrapClass:"collect-button-wrap",defaultActionClass:"collect-default",expandedMenuClass:"collect-menu-open",expandMenuClass:"collect-menu",expandMenuLoadingClass:"collect-menu-loading",menuWrapClass:"collect-menu-wrap",addToCollectionClass:"add-to-collection",fadeEffects:true,messageAreaSuffix:"-msgarea",showMsgTime:60000,menuOffsetTop:0,menuOffsetRight:-8},initialize:function(){if(this.instanciated){return }this.instanciated=true;this.buttonwrap=$$("."+this.options.buttonwrapClass);this.defaultButtons=[];this.expandButtons=[];this.openTabs=[];this.preventDoubleClicks=false;this.menuwraps=[];this.menu=[];this.open=[];this.currentlyOpenIndex=null;this.visibleTweening=[];this.msgArea=[];this.menuLoadingDivs=[];this.showMsgTimer=false;if(Browser.Engine.trident&&(/MSIE 8/g.test(navigator.userAgent)||Browser.Engine.version<=5)){this.options.fadeEffects=false}window.addEvent("domready",function(){if(window.location.search&&window.location.search.contains("addcollection")){this.collectIt(0)}if(window.location.search&&window.location.search.contains("opencollectionlist")){this.openMenuRequest(0)}if(window.location.search&&window.location.search.contains("addtodefault")){this.collectIt(0)}}.bind(this));$(document.body).addEvents({showCollectMsg:function(G,E,F){if(!F){F=0}this.showMsg(F,G,E)}.bind(this),closeCollectMenu:function(){this.buttonwrap.each(function(E,F){this.closeMenu(F)},this)}.bind(this),click:function(H){var E=$(H.target);if(E.hasClass("new-collection")||E.getParent(".new-collection")){H.stop();if(E.getParent(".new-collection")){E=E.getParent(".new-collection")}var F=E.getParent("."+this.options.menuWrapClass);if(F){var G=F.retrieve("collectPath")}if(!G){G=window.location.pathname}this.openAddCollectionModal(E,G,this.currentlyOpenIndex)}}.bind(this)});this.findButtons();window.addEvent("domready",function(){this.findButtons()}.bind(this))},findButtons:function(){this.buttonwrap=$$("."+this.options.buttonwrapClass);if(this.buttonwrap){this.buttonwrap.each(function(E,F){if(!E.retrieve("processed")){E.store("processed",1);this.defaultButtons[F]=E.getElement("."+this.options.defaultActionClass);this.expandButtons[F]=E.getElements("."+this.options.expandMenuClass);if(this.defaultButtons[F]){this.defaultButtons[F].addEvent("click",function(G){G.stop();if(this.open[F]){this.closeMenu(F)}this.collectIt(F)}.bind(this))}if(this.expandButtons[F]){this.open[F]=false;this.expandButtons[F].addEvent("outerClick",function(H){if(this.open[F]){var G=$(H.target);if(!G.getParent("."+this.options.menuWrapClass)){this.closeMenu(F)}}}.bind(this));this.expandButtons[F].addEvent("click",function(G){G.stop();this.openMenuRequest(F)}.bind(this))}}},this)}},openMenuRequest:function(F){var E=(!this.open[F]?"open":"close");this[E+"Menu"](F);var G=this.buttonwrap[F].retrieve("collectPath");if(!G){G=window.location.pathname}G=G+((G.contains("?"))?"&":"?")+"__call="+this.options.callClass;if(E=="open"){new Request.JSON({url:G,onSuccess:function(H){if(H.modal){this.closeMenu(F);this.openModal(H,{collectionlist:1},F)}else{if(H.status==1){this.updateMenu(F,H.html,G)}}}.bind(this)}).post({action:"getCollectionList"})}},openAddCollectionModal:function(F,H,G){var E=(F)?F.retrieve("newcollectionextra",{}):{};E.openIndex=G;if(!H){H=window.location.pathname}new popcontroller({loadFromAjax:true,disableScroll:false,loadModalName:"Modal_AddCollection",loadFromUrl:H,title:"",type:"blue",initialWidth:508,extraGetObject:E}).popit()},openMenu:function(G){if(!this.menuwraps[G]){this.menuwraps[G]=new Element("div",{"class":this.options.menuWrapClass,styles:{opacity:0}});this.menu[G]=new Element("div",{"class":"iefix"});var E=new Element("div",{"class":"collect-menu-bottom"}),F=new Element("div",{"class":"collect-menu-inner"}).adopt(this.menu[G]);this.menuwraps[G].adopt(F).adopt(E);$("main").adopt(this.menuwraps[G]);this.menuwraps[G].addEvent("click",function(J){var H=$(J.target);if(H.hasClass(this.options.addToCollectionClass)||H.getParent("."+this.options.addToCollectionClass)){J.stop();var I=getEncodedClassVar(H,"collectionid-");this.collectIt(G,I)}}.bind(this));this.visibleTweening[G]=(this.buttonwrap[G].hasClass("visible-hover"))?true:false;this.openTabs[G]=new Element("div",{"class":"collect-button-sprite collect-button-open",opacity:0});this.buttonwrap[G].adopt(this.openTabs[G])}this.positionMenu(G);if(this.visibleTweening[G]){this.buttonwrap[G].removeClass("visible-hover").setStyle("opacity",1)}this.menu[G].addClass(this.options.expandMenuLoadingClass);this.expandButtons[G].addClass(this.options.expandedMenuClass);if(this.options.fadeEffects){this.menuwraps[G].setStyle("display","").tween("opacity",1);this.openTabs[G].setStyle("display","").fade("in")}else{this.menuwraps[G].setStyles({display:"",opacity:1});this.openTabs[G].setStyles({display:"",opacity:1})}this.open[G]=true;this.currentlyOpenIndex=G},positionMenu:function(G){var F=this.buttonwrap[G].getCoordinates($("main")),E=F.bottom+this.options.menuOffsetTop,H=$("main").getSize().x-F.right+this.options.menuOffsetRight;this.menuwraps[G].setStyles({top:E,right:H})},updateMenu:function(F,E,G){this.menu[F].set("html",E).removeClass(this.options.expandMenuLoadingClass);this.menuwraps[F].store("collectPath",G)},showMenuLoading:function(F){if(this.open[F]){if(!this.menuLoadingDivs[F]){this.menu[F].addClass("relative");var E=this.menu[F].getSize();this.menuLoadingDivs[F]=new Element("div",{"class":"loader-throb-blue",styles:{height:E.y,width:E.x,position:"absolute",top:0,left:0,opacity:0.4,"background-color":"#f4f4f4"}});this.menu[F].adopt(this.menuLoadingDivs[F])}this.menuLoadingDivs[F].setStyle("display","")}},hideMenuLoading:function(E){if(this.menuLoadingDivs[E]){this.menuLoadingDivs[E].setStyle("display","none")}},collectIt:function(F,E){if(!this.preventDoubleClicks){this.preventDoubleClicks=true;(function(){this.preventDoubleClicks=false}.bind(this)).delay(1500);this.showMenuLoading(F);var G=this.buttonwrap[F].retrieve("collectPath");if(!G){G=window.location.pathname}G=G+((G.contains("?"))?"&":"?")+"__call="+this.options.callClass;new Request.JSON({url:G,onSuccess:function(H){this.hideMenuLoading(F);if(H.msg){this.showMsg(F,H.msg,H.status)}if(H.status==1){this.closeMenu(F)}else{if(H.modal){this.openModal(H,{},F)}else{if(H.errors){}}}}.bind(this)}).post({action:"collect",colid:E})}},openModal:function(F,E,G){if(!E){E={}}var H=this.buttonwrap[G].retrieve("collectPath");if(!H){H=window.location.pathname}new popcontroller({loadFromAjax:true,disableScroll:false,loadModalName:F.modal,loadFromUrl:H,title:"",type:"blue",initialWidth:F.modalWidth,extraGetObject:E}).popit()},showMsg:function(F,G,E){if(!this.msgArea[F]&&this.buttonwrap[F]){this.msgArea[F]=$(this.buttonwrap[F].get("id")+this.options.messageAreaSuffix)}if(this.msgArea[F]){this.msgArea[F].set("html",G).wink(this.options.showMsgTime);if(E){this.msgArea[F].addClass("success")}else{this.msgArea[F].removeClass("success")}}else{window.fireEvent("nonButtonMsg",[G,E])}},closeMenu:function(E){if(this.menuwraps[E]&&this.open[E]){if(this.options.fadeEffects){this.menuwraps[E].get("tween").start("opacity",0).chain(function(){this.menuwraps[E].setStyle("display","none");this.open[E]=false}.bind(this));this.openTabs[E].fade("out")}else{this.menuwraps[E].setStyle("display","none");this.openTabs[E].setStyle("display","none");this.open[E]=false}this.expandButtons[E].removeClass(this.options.expandedMenuClass);if(this.visibleTweening[E]){this.buttonwrap[E].addClass("visible-hover");if(!this.buttonwrap[E].getParent(".over")){if(this.options.fadeEffects){this.buttonwrap[E].tween("opacity",0);this.buttonwrap[E].getElements(".visible-hover").fade("out")}else{this.buttonwrap[E].setStyle("opacity",0);this.buttonwrap[E].getElements(".visible-hover").setStyle("opacity",0)}}}}}};C.initialize();if($("profile-menu-wrap")){$(document.body).addEvent("click",function(H){var E=$(H.target);if(E.get("id")=="deletecol-btn"){H.stop();var F=getEncodedClassVar(E,"collectionid-");if(F){new Request.JSON({url:window.location.pathname+"?__call=Collect",onSuccess:function(I){if(I.status==1){$$(".collection.collectionid-"+F).each(function(J){J.get("slide").slideOut()});if(I.redirect){window.location=I.redirect}}}.bind(this)}).post({action:"deleteCollection",colid:F})}$("popdiv").fireEvent("closeme")}else{if(E.hasClass("collection-delete")){H.stop();var G=E.getParent(".collectionid"),F=getEncodedClassVar(G,"collectionid-");new popcontroller({contents:$("delete-collection-modal").get("html").replace("[colid]",F),loadFromAjax:false,disableScroll:false,title:"",type:"blue",initialWidth:360}).popit()}else{if(E.hasClass("collection-edit")){H.stop();var G=E.getParent(".collectionid"),F=getEncodedClassVar(G,"collectionid-");new popcontroller({loadFromAjax:true,disableScroll:false,loadModalName:"Modal_EditCollection",loadFromUrl:window.location.pathname,title:"",type:"blue",initialWidth:508,extraGetObject:{colid:F}}).popit()}else{if(E.hasClass("edit-desc")){H.stop();var G=E.getParent(".collectionitemid");if(G){D(G)}}else{if(E.hasClass("cancel-desc")){H.stop();var G=E.getParent(".collectionitemid");B(G)}else{if(E.get("id")=="savedesc-btn"){H.stop();A(E)}}}}}}});$$(".edit-desc-form").addEvent("submit",function(E){E.stop();A(this)});function A(G){var F=G.getParent(".collectionitemid");if(F){var E=getEncodedClassVar(F,"collectionitemid-"),H=F.getElement(".edit-desc-form"),I=H.getElement("textarea").get("value");new Request.JSON({url:window.location.pathname+"?__call=Collect",onSuccess:function(J){if(J.status==1){F.getElement(".desc-text").set("text",I);if(J.redirect){window.location=J.redirect}B(F)}else{}}.bind(this)}).post({action:"editDescription",colitemid:E,desc:I})}}function D(E){E.getElement(".edit-desc-form").reveal();E.getElement(".lower-actions").dissolve();E.getElement(".description-wrap").dissolve()}function B(E){E.getElement(".edit-desc-form").dissolve();E.getElement(".lower-actions").reveal();E.getElement(".description-wrap").reveal()}}})();var FancySortable=new Class({options:{handleSelector:"",hoverDuration:300,moveDuration:700,betweenEl:null,droppableClass:"droppable",hoverClass:"drag-over",betweenClass:"between-item",betweenOpenClass:"open",sortOverlayClass:"sortoverlay",dragOpacity:0.6,origOpacity:0.5,expandHeight:null},Implements:[Options,Events],initialize:function(B,C,A){this.setOptions(A);this.parentEl=$(B);if(!C||!this.parentEl){return }this.itemSelector=C;this.items=this.parentEl.getElements(this.itemSelector);if(!this.items||!this.items.length){return }this.itemSize=[];this.sortOverlays=[];this.sortHeights=[];this.betweens=[];this.addBetweens();this.initItems();this.addSortableOverlays();this.itemCoords=[];this.addSortableItems();this.addEvent("refresh",this.reset.bind(this));this.postInit()},initItems:function(){this.items.each(function(A,B){this.itemSize[B]=A.setStyle("overflow","hidden").store("index",B).getSize()},this)},postInit:function(){this.fireEvent("init")},addBetweens:function(){if(!this.options.betweenEl){this.options.betweenEl=this.items[0].get("tag")}if(!this.options.expandHeight){this.options.expandHeight=Math.round(this.items[0].getSize().y/2)}var A=new Element(this.options.betweenEl,{"class":this.options.betweenClass,styles:{height:0}});A.clone().inject(this.items[0],"before");this.items.each(function(B,C){A.clone().inject(B,"after")},this);A.destroy();this.betweens=this.parentEl.getElements("."+this.options.betweenClass).set("tween",{link:"cancel",duration:this.options.hoverDuration}).set("morph",{link:"cancel",duration:this.options.moveDuration})},addSortableOverlays:function(){if(!this.sortOverlayWrap){this.parentEl.setStyle("position","relative");var A=this.items[0].getPosition(this.parentEl);this.sortOverlayWrap=new Element("div",{styles:{position:"absolute",top:A.y,left:A.x,display:"none"}}).inject(this.parentEl)}this.sortHeights[0]=this.itemSize[0].y/2;this.sortOverlays[0]=new Element("div",{"class":this.options.sortOverlayClass+" "+this.options.droppableClass,styles:{height:this.sortHeights[0],width:this.itemSize[0].x}}).set("tween",{link:"cancel",duration:this.options.hoverDuration}).store("index",0);this.sortOverlayWrap.adopt(this.sortOverlays[0]);this.items.each(function(C,D){var B=D+1;this.sortHeights[B]=(this.itemSize[D].y+((this.items[D+1])?this.itemSize[D+1].y:0))/2;this.sortOverlays[B]=new Element("div",{"class":this.options.sortOverlayClass+" "+this.options.droppableClass,styles:{height:this.sortHeights[B],width:this.itemSize[D].x}}).set("tween",{link:"cancel",duration:this.options.hoverDuration}).store("index",B);this.sortOverlayWrap.adopt(this.sortOverlays[B])},this)},addSortableItems:function(){var B=(this.options.handleSelector?this.options.handleSelector:this.itemSelector);var A=null;this.parentEl.addEvents({mousedown:function(E){if(E&&E.rightClick){return }var D=$(E.target);if(D.hasClass(B.substr(1))||D.getParent(B)){A=D;var C=(!this.options.handleSelector)?D:D.getParent(this.itemSelector);this.fireEvent("mousedown",[C,D]);this.doDrag(C,E)}}.bind(this)})},doDrag:function(C,E){this.fireEvent("beforeStart",[E,C]);if(!this.windowScroller){this.windowScroller=new Scroller(window)}E.stop();this.windowScroller.start();this.sortOverlayWrap.setStyle("display","");var B=C.getCoordinates();var D=C.retrieve("index");C.setStyle("opacity",this.options.origOpacity).set("morph",{link:"cancel",duration:this.options.moveDuration});var F=C.clone().setStyles(B).setStyles({opacity:this.options.dragOpacity,position:"absolute","z-index":9000}).set("morph",{link:"cancel",duration:this.options.moveDuration}).addClass("dragging").inject(document.body);var A=new Drag.Move(F,{droppables:"."+this.options.droppableClass,onDrop:function(G,H){this.dropped(G,H);this.sortOverlayWrap.setStyle("display","none");if(H){if(H.hasClass(this.options.sortOverlayClass)){this.reSortDropped(G,H,C,D,B)}else{this.droppedUnknown(G,H,C,D)}}else{this.cancelDrag(C,G,B);this.fireEvent("missed",[G,C])}}.bind(this),onEnter:function(G,H){this.fireEvent("enter",[G,H]);H.addClass(this.options.hoverClass);if(H.hasClass(this.options.sortOverlayClass)){this.hoverOver(G,H,D)}}.bind(this),onLeave:function(G,H){this.fireEvent("leave",[G,H]);H.removeClass(this.options.hoverClass);if(H.hasClass(this.options.sortOverlayClass)){this.hoverOut(G,H,D)}}.bind(this),onCancel:function(G){this.dropped(G);this.fireEvent("cancel",[G,C]);this.sortOverlayWrap.setStyle("display","none");F.destroy();C.setStyle("opacity",1)}.bind(this)});A.start(E);this.fireEvent("start",[A,C,F])},dropped:function(A,B){this.windowScroller.stop();this.fireEvent("dropped",[A,B])},hoverOver:function(C,D,B){var A=D.retrieve("index");if(B!=A-1&&A!=B){this.betweens[A].tween("height",this.options.expandHeight).addClass(this.options.betweenOpenClass);D.tween("height",this.sortHeights[A]+this.options.expandHeight);this.fireEvent("hoverOver",[C,D,A,B])}},hoverOut:function(C,D,B){var A=D.retrieve("index");this.betweens[A].tween("height",0).removeClass(this.options.betweenOpenClass);D.tween("height",this.sortHeights[A]);this.fireEvent("hoverOut",[C,D,A,B])},reSortDropped:function(I,F,J,C,B){var D=F.retrieve("index");if(C!=D-1&&D!=C){J.setStyles({opacity:1});var E=this.betweens[D],G=E.getCoordinates(),H=I.getSize().y,A=D;if(D>C){G.top=G.top-H;A=D-1}J.get("morph").start({height:0,opacity:0}).chain(function(){var K="after";if(this.items[D]){J.dispose().setStyles({margin:0,opacity:1,visibility:"visible",height:""}).inject(this.items[D],"before")}else{J.dispose().setStyles({margin:0,opacity:1,visibility:"visible",height:""}).inject(this.items[D-1],"after");K="before"}this.betweens[C].dispose().inject(J,K);this.fireEvent("moved",[J,A,D,C]);this.reset();this.postSort(J,A,C,D)}.bind(this));E.get("morph").start({height:H}).chain(function(){E.setStyle("height",0).removeClass(this.options.betweenOpenClass)}.bind(this));this.moveFadeAndDestroy(I,{top:G.top,left:G.left})}else{this.cancelDrag(J,I,B)}},postSort:function(C,B,D,A){this.fireEvent("sort",[this.items,C,B,D,A])},droppedUnknown:function(A,B){this.fireEvent("drop",[A,B])},cancelDrag:function(B,C,A){B.setStyle("opacity",1);this.moveFadeAndDestroy(C,A)},moveFadeAndDestroy:function(B,A){B.get("morph").start(A).chain(function(){this.start({opacity:0}).chain(function(){this.element.destroy()})})},reset:function(){if(this.sortOverlayWrap){this.sortOverlayWrap.empty()}this.sortHeights=[];this.sortOverlays=[];this.items=this.parentEl.getElements(this.itemSelector);this.initItems();this.parentEl.getElements("."+this.options.betweenClass).destroy();this.addBetweens();this.addSortableOverlays()}});var CollectionSort=new Class({Extends:FancySortable,options:{moveToNewCollection:false},postInit:function(){this.parentEl.addEvent("click",function(D){if(D&&D.rightClick){return }var B=$(D.target);if(B.hasClass("delete")){var A=getEncodedClassVar(B.getParent(this.itemSelector),"collectionitemid-");new popcontroller({contents:$("delete-collectionitem-modal").get("html").replace("[colitemid]",A),loadFromAjax:false,disableScroll:false,title:"",type:"blue",initialWidth:360}).popit()}else{if(B.hasClass("move-up")){D.stop();var C=B.getParent(this.itemSelector);this.moveItem(C,"up")}else{if(B.hasClass("move-down")){D.stop();var C=B.getParent(this.itemSelector);this.moveItem(C,"down")}}}}.bind(this));$(document.body).addEvent("click",function(C){var A=$(C.target);if(A.get("id")=="delete-btn"){C.stop();var B=getEncodedClassVar(A,"collectionitemid-");if(B){new Request.JSON({url:window.location.pathname+"?__call=Collect",onSuccess:function(D){if(D.status==1){$$(".collection-item-wrap.collectionitemid-"+B).each(function(F){F.get("reveal").dissolve().chain(function(){F.destroy();this.reset()}.bind(this))},this);var E=$("profile-menu-wrap").getElement(".menu-selected .collection-count");E.set("html",E.get("text").toInt()-1)}}.bind(this)}).post({action:"delete",colitemid:B})}$("popdiv").fireEvent("closeme")}}.bind(this));window.addEvent("nonButtonMsg",function(B,A){});this.fireEvent("init")},moveItem:function(I,G){var B=I.retrieve("index");if(G=="up"){var A=B-1;var C=B;var H=B-1;var D=-1*this.itemSize[B].y;var F="before"}else{var A=B+1;var C=A;var H=A+1;var D=this.itemSize[B].y;var F="after"}if(this.items[A]){var E=I.getCoordinates(this.parentEl);I.setStyles({top:E.top,left:E.left,position:"absolute",width:this.itemSize[B].x,"z-index":3000}).set("morph",{link:"cancel",duration:this.options.moveDuration});this.betweens[C].morph({height:[this.itemSize[B].y,0]});this.betweens[H].morph({height:this.itemSize[B].y});I.get("morph").start({top:(E.top+D)}).chain(function(){this.items[A].grab(I,F);I.setStyles({position:"",top:"",left:"",width:"","z-index":""});this.betweens[H].setStyles({height:0});this.betweens[H].get("morph").cancel();this.reset();this.postSort(I,A,B)}.bind(this))}},doDrag:function(A,B){this.parent(A,B);$("content").addClass("dragging");this.createNewFromDragEl=$("content").getElement(".drag-new-collection");if(this.createNewFromDragEl){this.createNewFromDragEl.reveal()}},dropped:function(A,B){$("content").removeClass("dragging");if(this.createNewFromDragEl){this.createNewFromDragEl.dissolve()}this.parent(A,B)},postSort:function(D,C,E,B){var A=getEncodedClassVar(D,"collectionitemid-");new Request.JSON({url:window.location.pathname+"?__call=Collect",onSuccess:function(F){if(F.status){}else{}}.bind(this)}).post({action:"order",colitemid:A,newindex:C,oldindex:E})},droppedUnknown:function(F,H,E){if(H.hasClass("collection")){var C=getEncodedClassVar(H,"collectionid-"),B=getEncodedClassVar(E,"collectionitemid-");if(this.options.moveToNewCollection){new Request.JSON({url:window.location.pathname+"?__call=Collect",onSuccess:function(I){if(I.status==1){this.animateMove(F,H,E)}else{var J=E.getElement(".msgarea");if(J&&I.msg){J.removeClass("green-text").addClass("error");J.set("html",I.msg);J.wink(6000)}this.cancelDrag(E,F,E.getCoordinates());H.highlight("#f8aea6")}}.bind(this)}).post({action:"move",colitemid:B,colid:C})}else{new Request.JSON({url:window.location.pathname+"?__call=Collect",onSuccess:function(I){if(I.status){this.animateCopy(F,H,E,I)}else{this.cancelDrag(E,F,E.getCoordinates())}}.bind(this)}).post({action:"copy",colitemid:B,colid:C})}}else{if(H.hasClass("drag-new-collection")){this.animateCopy(F,H,E);var B=getEncodedClassVar(E,"collectionitemid-");var A={createFrom:B,refreshrequired:true};var D=E.getElement(".collection-item-title a");var G=null;if(D){G=D.get("href")}if(!G){G=window.location.pathname}new popcontroller({loadFromAjax:true,disableScroll:false,loadModalName:"Modal_AddCollection",loadFromUrl:G,title:"",type:"blue",initialWidth:508,extraGetObject:A}).popit()}else{this.fireEvent("drop",[F,H])}}},animateCopy:function(E,F,D,B){F.removeClass(this.options.hoverClass);E.get("morph").start({opacity:0}).chain(function(){E.destroy();D.setStyle("opacity",1)}.bind(this));var C=D.getElement(".msgarea");if(C&&B){if(B.status==1){C.removeClass("error").addClass("green-text")}else{C.removeClass("green-text").addClass("error")}C.set("html",B.msg);C.wink(6000)}F.set("tween",{onComplete:function(){F.setStyle.delay(200,F,["background-color",""])}});if(B){if(B.status==1){var G=F.getElement(".collection-count");G.set("html",G.get("text").toInt()+1);var A=G.getStyle("color");G.getParent(".count-wrap").tween("color","#002211",A);F.highlight()}else{F.highlight("#f8aea6")}}else{F.highlight()}},animateMove:function(C,D,B){D.removeClass(this.options.hoverClass);C.get("morph").start({opacity:0}).chain(function(){C.destroy();B.get("reveal").dissolve().chain(function(){B.destroy();this.reset()}.bind(this))}.bind(this));var E=D.getElement(".collection-count");E.set("html",E.get("text").toInt()+1);var A=E.getStyle("color");E.getParent(".count-wrap").tween("color","#002211",A);var E=$("profile-menu-wrap").getElement(".menu-selected .collection-count");E.set("html",E.get("text").toInt()-1);D.highlight()}});var CollectionPreview=new Class({options:{triggerSelector:".collectionPreview",collectionIdBase:"collectionid-",injectIntoId:"main",parentElId:"content",openDelay:1000,closeDelay:1000,arrowPositionSprite:810,arrowPositionPercent:65,arrowHeight:60,arrowWidth:30,fixedLeftWidth:50,marginRight:50},Implements:[Options,Events],initialize:function(A){this.setOptions(A);this.openDelay=null;this.closeDelay=null;this.overBox=null;this.openBoxId=null;this.parentEl=$(this.options.parentElId);this.trig=null;this.colid=null;this.cache={};this.registerEvents();window.addEvent("registerPreviewTriggers",(function(B){this.registerEvents(B)}).bind(this))},registerEvents:function(C){C=C||this.parentEl;var B=this;var A=C.getElements(this.options.triggerSelector);if(A){A.each(function(D,E){D.addEvents({mouseenter:function(F){$clear(B.openDelay);B.trig=D;if(this.openBoxId!=E){B.openDelay=B.showPreview.delay(B.options.openDelay,B,[D,E])}$clear(B.closeDelay)},mouseleave:function(F){$clear(B.openDelay);B.trig=null;B.colid=null;B.closeDelay=B.closePreview.delay(B.options.closeDelay,B)}})})}},closePreview:function(){if(!this.overBox){this.hideBox();this.openBoxId=null}},showPreview:function(B,C){var A=getEncodedClassVar(B,this.options.collectionIdBase);if(A){this.colid=A;this.openBoxId=C;this.makeBox();this.showBox();this.showLoading();this.positionBox();if(this.cache[A]){return this.handleResults(this.cache[A])}if(!this.req){this.req=new Request.JSON({url:window.location.pathname+"?__call=Collect",onSuccess:this.handleResults.bind(this)})}this.req.post({action:"getPreview",colid:A})}},showBox:function(){if(this.box){this.box.setStyle("display","")}},hideBox:function(){if(this.box){this.box.setStyle("display","none")}},handleResults:function(C){if(C.status&&C.html){var B=new Element("div",{html:C.html,styles:{position:"absolute",bottom:0,visibility:"hidden"}}).inject(document.body);var A=B.getSize();B.destroy();this.setBoxWidth(A.x);this.setBoxHeight(A.y);this.setBoxContents(C.html);this.positionBox();if(this.colid&&!this.cache[this.colid]){this.cache[this.colid]=C}}},positionBox:function(){if(this.box&&this.trig){var B=this.trig.getCoordinates($(this.options.injectIntoId)),A=this.trig.getCoordinates();height=this.midleft.getSize().y,previewArrowOffset=(this.options.arrowPositionPercent/100)*height,arrowBackgroundOffset=Math.round(this.options.arrowPositionSprite-(previewArrowOffset)),previewTop=Math.round(B.top+(B.height/2)-(previewArrowOffset)-(this.options.arrowHeight/2)),previewLeft=(B.right-this.options.arrowWidth),boxSize=this.box.getSize(),windowx=window.getWidth(),arrowSide="midleft",bgPosition="0 -"+arrowBackgroundOffset+"px";if((windowx-A.left-(B.width/2))<(A.left+(B.width/2))){arrowSide="midright";previewLeft=(B.left+this.options.arrowWidth-boxSize.x);bgPosition="100% -"+arrowBackgroundOffset+"px"}this.midleft.setStyle("background-position","0 -50px");this.midright.setStyle("background-position","100% -50px");this[arrowSide].setStyle("background-position",bgPosition);this.box.setStyles({top:previewTop+"px",left:previewLeft+"px"})}},makeBox:function(){if(!this.box){this.box=new Element("div",{"class":"collection-preview-box-wrap",styles:{"z-index":9999,position:"absolute"}});this.top=new Element("div",{"class":"collection-preview-top containme"});this.topleft=new Element("div",{"class":"collection-preview-box top-left"});this.topright=new Element("div",{"class":"collection-preview-box top-right"});this.bot=new Element("div",{"class":"collection-preview-bot containme"});this.botleft=new Element("div",{"class":"collection-preview-box bottom-left"});this.botright=new Element("div",{"class":"collection-preview-box bottom-right"});this.mid=new Element("div",{"class":"collection-preview-mid containme"});this.midleft=new Element("div",{"class":"collection-preview-box inner-left"});this.midright=new Element("div",{"class":"collection-preview-box inner-right collection-preview-inner"});this.inner=new Element("div",{"class":"collection-preview-box-inner"});this.top.adopt(this.topleft,this.topright);this.mid.adopt(this.midleft.adopt(this.midright.adopt(this.inner)));this.bot.adopt(this.botleft,this.botright);this.box.adopt(this.top,this.mid,this.bot);this.setBoxWidth(150);this.box.addEvents({mouseenter:function(A){this.overBox=true;$clear(this.closeDelay)}.bind(this),mouseleave:function(A){this.overBox=false;this.closeDelay=this.closePreview.delay(this.options.closeDelay,this)}.bind(this)});$(this.options.injectIntoId).adopt(this.box)}},setBoxWidth:function(A){if(this.box){this.box.setStyle("width",A+this.options.fixedLeftWidth+this.options.marginRight);$$(this.topright,this.midright,this.botright).setStyle("width",(A+this.options.marginRight))}},setBoxHeight:function(A){if(this.box){this.box.setStyle("height",A)}},setBoxContents:function(A){if(this.box){this.inner.set("html",A)}},showLoading:function(){this.setBoxContents('<div style="height:150px;"><div class="loader-throb-blue" style="height: 140px;"></div>');this.setBoxWidth(150)}});if(!window.loadedPreviewer){window.addEvent("domready",function(){new CollectionPreview()});window.loadedPreviewer=true}var CollectionCoursel=new Class({Implements:[Options,Events],options:{leftArrowSelector:".left-arrow",rightArrowSelector:".right-arrow",containerSelector:".carousel-contents",slideAreaSelector:".slide-area",itemClass:"collection-thumb-wrap",animateDuration:800},initialize:function(B,A){this.setOptions(A);this.parentEl=$(B)||$(document.body);this.leftArrow=this.parentEl.getElement(this.options.leftArrowSelector);this.rightArrow=this.parentEl.getElement(this.options.rightArrowSelector);this.container=this.parentEl.getElement(this.options.containerSelector);this.slideArea=this.parentEl.getElement(this.options.slideAreaSelector);this.items=this.parentEl.getElements("."+this.options.itemClass);this.numItems=this.items.length;if(!this.container||!this.leftArrow||!this.rightArrow||!this.slideArea||!this.items){return }this.calculateSlideWidth();this.slideArea.setStyles({position:"absolute",top:0,left:0,width:(this.numItems*this.itemWidth)+"px"});this.page=1;this.rightArrow.removeClass("disabled");this.slideArea.set("morph",{link:"cancel",duration:this.options.animateDuration});this.addArrowEvents()},calculateSlideWidth:function(){this.itemWidth=this.container.getElement("."+this.options.itemClass).getSize().x;this.itemsPer=Math.round(this.container.getSize().x/this.itemWidth);this.maxPages=Math.ceil(this.numItems/this.itemsPer);this.slideWidth=this.itemsPer*this.itemWidth},addArrowEvents:function(){this.leftArrow.addEvent("click",function(A){A.stop();this.slideIt(this.page-1)}.bind(this));this.rightArrow.addEvent("click",function(A){A.stop();this.slideIt(this.page+1)}.bind(this))},slideIt:function(A){if(A<1){this.page=1;return }if(A>this.maxPages){this.page=this.maxPages;return }this.page=A;if(!this.slideWidth){this.calculateSlideWidth()}var B=-1*(A-1)*this.slideWidth;this.slideArea.morph({left:B});if(this.page<=1){this.leftArrow.addClass("disabled")}else{if(this.page==this.maxPages){this.rightArrow.addClass("disabled")}else{this.rightArrow.removeClass("disabled");this.leftArrow.removeClass("disabled")}}}});var CollectionBrowse=$(document.body).getElement(".CollectionBrowse");if(CollectionBrowse){window.addEvent("domready",function(){$("gradefilter").removeEvents("change");var F=CollectionBrowse.get("id").replace("pmid_","").toInt();var E=function(G,J){A();var H={__replace:F};var I="";if(G.indexOf("?")){I=G.substr(G.indexOf("?")+1)}if(!J){C.addState(I)}new Request({url:G,onSuccess:function(K){CollectionBrowse.set("html",K);D();window.fireEvent("equalize",CollectionBrowse);window.fireEvent("registerPreviewTriggers",CollectionBrowse)}}).post(H)};var A=function(){var G=CollectionBrowse.setStyle("position","relative").getComputedSize();new Element("div",{"class":"loader-throb-blue",styles:{height:G.totalHeight,width:G.totalWidth,position:"absolute",top:0,left:0,opacity:0.7,"background-color":"#ffffff"}}).inject(CollectionBrowse)};var D=function(){$("gradefilter").addEvent("change",function(G){E(this.get("value"))});$("collection-browse-sort").addEvent("click",function(G){if($(G.target).get("tag")=="a"){G.stop();E($(G.target).get("href"))}});CollectionBrowse.getElement(".pagination-area").addEvent("click",function(G){if($(G.target).get("tag")=="a"&&!$(G.target).hasClass("pagination-expander")){G.stop();E($(G.target).get("href"))}})};D();var C=new HistoryManager({realurls:false});C.addEvent("onHistoryChange",function(G){E(window.location.pathname+"?"+G,true)}.bind(this));var B=C.getCurrentLocation();if(B&&B!=""){E(window.location.pathname+"?"+B,true)}})};