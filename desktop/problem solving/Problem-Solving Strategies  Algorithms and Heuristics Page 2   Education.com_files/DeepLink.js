/* JSCmprsd Hash:02317529dddcde49d23af49fcaa47bb4 */
var DeepLink=new Class({Implements:Options,id:null,info:null,link:null,popup:null,timer:null,timerEl:null,sprite:null,highestIndex:null,options:{paddingLeft:5,paddingTop:5,displayDelay:1,spriteSrc:"/i/widgets/timer-sprite.png",spriteCols:15,spriteWidth:12,spriteHeight:10,activeClass:"deeplinks-activeLink",autoWrap:true},initialize:function(B,A){this.setOptions(A);this.id=B.get("id").replace(/^deeplink\-/,"");this.info=$("info-"+this.id);this.link=B;this.title=this.link.get("text");B.href=B.href+"?__module=DeepLink&hit&id="+this.id;var C=this;if(this.info){this.info.getElements("a").each(function(D){D.href=D.href+"?__module=DeepLink&hit&id="+C.id});this.link.addEvents({mouseenter:function(){C.startTimer()},mouseleave:function(){C.endTimer()}})}this.link.store("deeplink",this);this.applyScrollFix();if(this.options.autoWrap){this.applyWrap()}},applyWrap:function(){var A=this.link.getCoordinates();if(A.width>500){new Element("div").inject(this.link,"before")}},open:function(){this.getSprite().element.setStyle("opacity",0);this.getPopup().setStyle("opacity",1);this.link.addClass(this.options.activeClass)},close:function(){this.getPopup().tween("opacity",0);this.link.removeClass(this.options.activeClass)},startTimer:function(){this.timer=this.open.bind(this).delay(this.options.displayDelay*1000);this.getSprite().animate(1,14,0,this.options.displayDelay);this.getSprite().element.tween("opacity",1)},endTimer:function(){this.getSprite().element.tween("opacity",0);$clear(this.timer)},getPopup:function(){if(!this.popup){var A=new Element("a",{id:"deeplink-overlay-"+this.id,"class":"deeplink-overlay",text:this.title+":",styles:{position:"absolute"}});if(!A.get("text")){A.innerHTML=this.title+":"}var B=new Element("div",{"class":"deeplink-box-right",html:this.info.get("html")});this.popup=new Element("div",{"class":"deeplink-popup",id:"deeplink-popup-"+this.id,styles:{opacity:0}});this.popup.adopt(A);this.popup.adopt(B);this.popup.inject(this.link.getParent("div"),"after");this.popup.addEvent("mouseleave",(function(){this.close()}).bind(this))}this.positionPopup();return this.popup},positionPopup:function(){var D=10;var F=this.link.getCoordinates();var C=this.popup.getElement(".deeplink-overlay");var E={top:F.top-this.options.paddingTop-1,left:F.left-this.options.paddingLeft-1};this.positionElement(C,E);C.setStyles("width",F.width+D);this.applyShim(C,E);C.setStyle("z-index",this.getHighestIndex()+1);var B=C.getCoordinates();var A=this.popup.getElement(".deeplink-box-right");E={left:B.right-2,top:F.top-(this.options.paddingTop)-1};this.positionElement(A,E);A.setStyle("z-index",this.getHighestIndex());this.applyShim(A,E)},getSprite:function(){if(!this.timerEl){this.timerEl=new Element("span",{"class":"deeplink-timer"});this.timerEl.inject(this.link,"before")}if(!this.sprite){this.sprite=new Sprite(this.options.spriteSrc,this.timerEl,{fWidth:this.options.spriteWidth,fHeight:this.options.spriteHeight,cols:this.options.spriteCols})}this.positionSprite();this.sprite.element.setStyle("opacity",0);return this.sprite},positionSprite:function(){var A=this.link.getCoordinates();this.timerEl.setStyles({position:"absolute","z-index":this.getHighestIndex()+1});this.positionElement(this.timerEl,{top:A.top,left:A.right})},applyShim:function(A,B){var E=A.getCoordinates();var D=A.getStyle("z-index")-1;if(!A.retrieve("shim")){var C=new Element("iframe",{src:"",scrolling:"no",frameborder:0,width:E.width,height:E.height,styles:{zIndex:D,position:"absolute",border:"none"}}).setStyle("opacity",0);C.inject(A,"after");A.store("shim",C)}this.positionElement(A.retrieve("shim"),B)},getHighestIndex:function(B){if(this.highestIndex>0){return this.highestIndex}if(Browser.Engine.trident){this.highestIndex=9999;return this.highestIndex}var A=1;$$("*").each(function(C){var D=$(C).getStyle("z-index");if($type(D)=="string"){D=D.toInt()}if(D>A){A=D}});this.highestIndex=A;return A},positionElement:function(A,B){A.setStyles(B);this.repositionElement(A,B)},repositionElement:function(A,B){var D=A.getCoordinates();var C={};$H(B).each(function(F,E){if(!D[E]||!B[E]){return }var G=D[E]-B[E];C[E]=B[E]-G});A.setStyles(C)},applyScrollFix:function(){var A=this;var B=$(window);if(!B.retrieve("deeplinks-scrollfixEvent")){B.addEvent("scroll",function(){$$("."+A.options.activeClass).each(function(C){C.retrieve("deeplink").close()})})}B.store("deeplinks-scrollfixEvent",true)}});