/* JSCmprsd Hash:b5f7adcfac6b3d9b8b1cbe52e30459da */
var CollapsibleComments=new Class({Implements:Options,options:{commentsId:"comments",commentsListId:"comments-list",commentSlideId:"comments-slide",openCommentsClass:"showhide-comments",addCommentLinkClass:"post-comment",postTemplateId:"post-template",postCloseBtnClass:"post-box-close-btn",postFormId:"popin-comment-form",errorTextDivId:"errortext1",errorDivId:"errorrow1",showLinkText:"",hideLinkText:"",highlightClass:"highlight-comment",currentCount:0,slideDuration:800},initialize:function(E,A){this.setOptions(A);this.commentsDiv=$(this.options.commentsId);this.commentsList=$(this.options.commentsListId);this.slideTriggers=this.commentsDiv.getElements("."+this.options.openCommentsClass);this.slideArea=$(this.options.commentSlideId);this.expndr=false;this.initiallyOpened=E;this.postBoxOpen=false;var B=this.commentsDiv.getElement(".comment-count");this.currentCount=(B)?B.get("text").toInt():this.options.currentCount;var D=this;if(this.slideTriggers&&this.slideArea){this.slideTriggers.addEvent("click",function(F){F.stop();if(D.currentCount!==0){if(!D.expndr){if(!D.initiallyOpened){D.slideArea.setStyle("display","")}D.expndr=new Fx.Slide(D.slideArea,{duration:D.options.slideDuration});if(!D.initiallyOpened){D.expndr.hide()}}D.swapText();D.expndr.toggle();if(D.postBoxOpen){D.closePostPopIn()}}})}this.setupPopin=false;this.template=$(this.options.postTemplateId);this.postComments=this.commentsDiv.setStyle("position","relative").getElements("."+this.options.addCommentLinkClass);this.errortextdiv=$(this.options.errorTextDivId);this.errordiv=$(this.options.errorDivId);this.loginattempts=0;if(this.postComments&&this.template){this.postComments.addEvent("click",function(F){F.stop();D.openPostPopIn(this)});this.template.getElement("."+this.options.postCloseBtnClass).addEvent("click",function(F){F.stop();D.closePostPopIn()});var C=new Hash({click:{"addcomment-btn":function(H){H.stop();var G=$("addcomment-btn");D.showLoading(G);var F=$(D.options.postFormId);new Request.JSON({method:"post",url:window.location.href,link:"ignore",onSuccess:function(I){try{D.hideLoading(G);if($type(I)=="object"){if(I.status==1){if(I.redirect){(function(){window.location=I.redirect}).delay(300)}else{if(I.newcomment){G.fade("out");D.showGoodMsg(I.msg);D.addNewComment(I.newcomment)}else{if(I.html){$("comment-login").set("html",I.html).setStyle("display","");$("comment-form").setStyle("display","none")}}}}else{D.showError(I.error)}}}catch(J){}}}).send($(D.options.postFormId).toQueryString())},"commentlogin-btn":function(G){G.stop();var F=$("commentlogin-btn");D.showLoading(F);$("statmod").set("name","__json");new Request.JSON({method:"post",url:window.location.href,link:"ignore",onSuccess:function(L){try{D.hideLoading(F);if(L.responseCode===0&&L.errors){D.loginattempts++;if(D.loginattempts>1){var I=($("commentlogin-forgot").getStyle("font-size")).toInt();if(I<15){$("commentlogin-forgot").setStyle("font-size",($("commentlogin-forgot").getStyle("font-size").toInt()+1+"px"))}else{if(I==15){$("commentlogin-forgot").setStyle("font-weight","bold")}}}var H="";L.errors.each(function(M,N){H+=M;if(N!=L.errors.length-1){H+="<br />"}});D.showError(H)}else{if(L.responseCode==1){$("loginbuttonwrap").fade("out");D.showGoodMsg(L.msg);if(L.redirect==1){var J=(L.redirecturl)?L.redirecturl:window.location.href;(function(){window.location=J}).delay(1000)}else{(function(){}).delay(700)}}}}catch(K){}}}).send($("commentloginid").toQueryString())},"edit-post":function(F){F.stop();$("comment-login").setStyle("display","none");$("comment-form").setStyle("display","")}},keydown:{"comment-textarea":this.clearError.bind(this),"username-commentlogin":this.clearError.bind(this),commentloginpassword:this.clearError.bind(this)}});C.each(function(F,G){D.template.addEvent(G,function(H){if(F[$(H.target).get("id")]){F[$(H.target).get("id")](H)}else{}})})}},showLoading:function(B){if(!this.loadingDiv){this.loadingDiv=new Element("div",{"class":"results-loading",styles:{display:"none",opacity:0.5}}).inject(this.template)}var A=this.template.getSize();this.loadingDiv.setStyles({width:A.x,height:A.y,display:""})},hideLoading:function(){if(this.loadingDiv){this.loadingDiv.setStyle("display","none")}},openComments:function(){if(!this.expndr){if(!this.initiallyOpened){this.slideArea.setStyle("display","")}this.expndr=new Fx.Slide(this.slideArea,{duration:this.options.slideDuration});if(!this.initiallyOpened){this.expndr.hide()}}if(!this.expndr.open){this.swapText();this.expndr.toggle();return true}return false},closeComments:function(){if(!this.expndr){if(!this.initiallyOpened){this.slideArea.setStyle("display","")}this.expndr=new Fx.Slide(this.slideArea,{duration:this.options.slideDuration});if(!this.initiallyOpened){this.expndr.hide()}}if(this.expndr.open){this.swapText();this.expndr.toggle();return true}return false},swapText:function(){this.slideTriggers.each(function(A){A.set("html",this.options[((this.expndr.open)?"show":"hide")+"LinkText"].replace("[COUNT]",this.currentCount))},this)},addNewComment:function(C){var A=new Element("ul",{html:C});this.commentsList.adopt(A.getElement("li"));var B=this.commentsList.getLast("li");this.commentsList.fireEvent("addNewHoverFx",B);var D=this.commentsDiv.getElements(".comment-count");this.currentCount=this.currentCount+1;D.set("html",this.currentCount);(function(){this.closePostPopIn(true);if(!this.openComments()){if(this.expndr){(function(){this.expndr.slideIn()}).delay(300,this)}}(function(){new Fx.Scroll(window,{duration:1200}).toElement(B)}).delay(800)}).delay(2000,this)},showGoodMsg:function(A){this.errortextdiv.setStyle("border","1px solid green");this.showError(A)},showError:function(A){this.errortextdiv.set("html",A);if(this.errordiv.getStyle("display")=="none"){this.errortextdiv.slide("hide");this.errordiv.setStyle("display","")}this.errortextdiv.slide("in")},clearError:function(){if(this.errordiv.getStyle("display")!="none"){this.errortextdiv.slide("out");this.errortextdiv.setStyle("border","1px solid red")}},closePostPopIn:function(A){this.template.setStyles({top:0,right:0,display:"none"});this.postBoxOpen=false;if(A){this.template.getElement("textarea").set("value","");$("addcomment-btn").fade("show");this.clearError()}},openPostPopIn:function(A){if(!this.setupPopin){$("content").adopt(new Element("div",{"class":"clear"})).setStyle("overflow","visible");$("addcomment-action").set("value","addcomment");$("target").set("name","__json");this.setupPopin=true}var B=A.getCoordinates(this.commentsDiv);this.template.setStyles({position:"absolute","z-index":1000,top:B.top-10,right:-12,display:""});this.postComments.setStyle("z-index","");A.setStyles({"z-index":1001,position:"relative"});this.postBoxOpen=true}});